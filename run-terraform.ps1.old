param (
    [Parameter(ValueFromRemainingArguments = $true)]
    [string[]]$args
)

$projectPath = (Get-Location).Path

$awsPath = Join-Path $env:USERPROFILE ".aws"

# Silencia log para comandos que devem retornar saída limpa
$showLog = $true
$argLine = $args -join " "
if ($argLine -match "^(state|output)\b") {
    $showLog = $false
}

if ($showLog) {
    Write-Host "Executando comando: terraform $argLine"
    Write-Host "Montando volume do projeto: $projectPath"
    Write-Host "Montando credenciais AWS: $awsPath"
}

docker run --rm `
  -v "${projectPath}:/workspace" `
  -v "${awsPath}:/root/.aws" `
  -w /workspace `
  hashicorp/terraform:light `
  @args
